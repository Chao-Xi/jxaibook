
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob AI学习笔记">
      
      
        <meta name="author" content="Jacob Xi">
      
      
      
        <link rel="prev" href="../1mcp_intro/">
      
      
        <link rel="next" href="../2mcp_construction_principle/">
      
      
        
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>1 代码讲透MCP原理 - Jacob AI Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-mcp" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob AI Book" class="md-header__button md-logo" aria-label="Jacob AI Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob AI Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1 代码讲透MCP原理
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxaibook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jxaibook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob AI Book" class="md-nav__button md-logo" aria-label="Jacob AI Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Jacob AI Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxaibook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jxaibook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI大模型应用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI大模型应用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1_ba/1intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 大模型的理论与技术的演进
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1_ba/2embedding_openai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 大模型开发基础：OpenAIEmbedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1_ba/3OpenaiModels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 大模型实战--OpenAI开发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1_ba/4chatgpt_translate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4 基于 ChatGPT 开发智能翻译助手
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1_ba/5AI_PM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5 产品经理的 5 个 AI 知识点：LLM、Agent、RAG、向量数据库、知识图谱
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AWS AI 应用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    AWS AI 应用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2_aws/1aws_term/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 AWS AI 词汇表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2_aws/2langchain_dynamodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 使用 LangChain搭建基于Amazon DynamoDB 的大语言模型应用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2_aws/3AmazonBedrock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 Amazon Bedrock 简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2_aws/4ML/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4 低代码机器学习
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Prompt Engineering
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Prompt Engineering
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3_prompt/4prompt_exp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0 Prompt Engineering 快速入门+实战案例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3_prompt/1prompt_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 Prompts & Use ChatGPT as a Powerful Tool for Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3_prompt/2prompt_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 11个顶级设计案例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3_prompt/3promt_fin_anylysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 Prompts for F-Analyst
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Python GPT
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python GPT
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4_python/1Meeting_minutes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating an automated meeting minutes generator with Whisper and GPT-4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4_python/2API_Basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chatGPT API basics.
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Python GPT
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python GPT
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4_python/1Meeting_minutes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating an automated meeting minutes generator with Whisper and GPT-4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4_python/2API_Basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chatGPT API basics.
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI基础学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI基础学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2024_zh/1intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 AI 简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2024_zh/2Prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 Prompt Engineering，提示工程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2024_zh/3prommaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 AI 编程简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2024_zh/4assistantapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4 OpenAI 的 Function Calling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2024_zh/5rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5 RAG和Embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deepseek 模型
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deepseek 模型
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp1/1dp1_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 DeepSeek 模型介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agent 学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agent 学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/0agent_qa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0 AI Agent 十问十答
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/1agant_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 AI Agents入门教程之概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/2agent_buildout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 AI Agents入门教程之从零开始构建Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/3agent_frameworks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 AI Agents入门教程之代理框架介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/4agent_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4 AI Agents入门教程之不同类型的智能体
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/5agentic_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5 为什么行业焦点从AI Agents转向Agentic Workflows？
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/6agent_school/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6 《AI智能体入门》课程讲述内容
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/7agai_geai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7 Agentic AI vs Generative AI: 区别与对比
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/8agent_mcp_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Agents, and the Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5_agents/9mcp_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8 爆火的Model Context Protocol是什么？
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MCP 学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    MCP 学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1mcp_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0 MCP 介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    1 代码讲透MCP原理
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    1 代码讲透MCP原理
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 MCP的通信方式
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-mcpsse" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 MCP的SSE通信流程
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcpsse" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP的SSE通信实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP的编程模型思考
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCP的编程模型思考">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcp-vs-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs REST API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-vs-mq" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs 消息队列（MQ）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-vs-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs WebSocket
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP服务的简单实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        总结：理解MCP的本质
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2mcp_construction_principle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 一文讲透MCP的原理及实践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    A2A 学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    A2A 学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7_a2a/1a2a_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 谷歌 A2A （Agent2Agent）架构设计深度剖析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7_a2a/2a2a_intro2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 关于A2A、MCP、Agent、LLM的6条极简事实
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7_a2a/3a2a_intro3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 谷歌 A2A 与 Anthropic MCP 协议深度解析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agentic LLMs for Developers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agentic LLMs for Developers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/0responseApi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0 OpenAI Responses API 与 Agents SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/0agents_demo1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0 从零构建一个多智能体旅行规划系统：基于 OpenAI Agents SDK 的工程化实践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/1ai_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 Introduction to Developing AI Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/2ai_agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 初识智能体
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/3ai_agents_his/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 智能体发展史
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI Agent Daily Blogs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI Agent Daily Blogs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/1agents_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1 AI Agent 技术栈全景图：LLM、MCP/Function Calling 与 A2A 协议实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/4agent_arg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2 Agentic RAG 七大架构范式深度解析：从单智能体到端到端自动化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8_agllm/5Agent_google/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3 Google AI Agent 白皮书深度拆解
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 MCP的通信方式
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-mcpsse" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 MCP的SSE通信流程
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcpsse" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP的SSE通信实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP的编程模型思考
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCP的编程模型思考">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcp-vs-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs REST API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-vs-mq" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs 消息队列（MQ）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-vs-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP vs WebSocket
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP服务的简单实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        总结：理解MCP的本质
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="2-mcp">2 代码讲透MCP原理</h1>
<h2 id="1-mcp">1 MCP的通信方式</h2>
<p>MCP提供了STDIO和SSE两种传输协议，当前很多实验性的工具都是使用STDIO传输。</p>
<p><strong>不过如果提供服务的话，基本就是SSE（Server-Sent Events）</strong>。所以本文重点分析讨论SSE的MCP接入模式。</p>
<p><img alt="Alt Image Text" src="../../images/chap6_1_1.png" title="Body image" /></p>
<p>SSE 与 WebSocket 作用相似，都是建立浏览器与服务器之间的通信渠道，然后服务器向浏览器推送信息。</p>
<p>总体来说，WebSocket 更强大和灵活。因为它是全双工通道，可以双向通信；</p>
<p><strong>SSE 是单向通道，只能服务器向浏览器发送，因为流信息本质上就是下载。如果浏览器向服务器发送信息，就变成了另一次 HTTP 请求。</strong></p>
<p>这个特点让我更加好奇了，stdio中可以使用stdin来进行输入，使用stdout来进行输出。但是SSE是单向通道，MCP要如何实现双向通信呢？是建立两根SSE通道吗？带着这个疑问，我开始了动手实践。</p>
<h2 id="2-mcpsse">2 MCP的SSE通信流程</h2>
<p>利用MCP官方提供的工具<code>npx @modelcontextprotocol/inspector</code> 可以比较方便地拉起一个验证MCP的管理页。</p>
<p>针对这个管理页抓包就能发现一些SSE的通信端倪。</p>
<p><img alt="Alt Image Text" src="../../images/chap6_1_2.png" title="Body image" /></p>
<p>1.<code>/sse</code>这个URL只负责推送信息，并不能发送信息，发送信息需要另外的URL。</p>
<p>2.Client连接上<code>/sse</code>这个地址的第一个Event就是告诉Client发送信息需要去哪个URL发，这个URL通常会带上唯一的会话ID。</p>
<p>观察这个抓包情况，我们前面的双向通信疑问基本可以有答案了：</p>
<p><strong>1.只有一根SSE长连接，用来Server向Client推送数据，另外一个Client向Server发送请求的通道是使用普通的HTTP POST请求。</strong></p>
<p>2.Client向Server发送的HTTP POST请求中只使用2xx反馈是否收到指令，所有的数据返回是通过一开始的SSE长连接来推送。</p>
<p>为了验证这个猜想，我还特地做一个实验，使用curl模拟了POST/messsage?sessionId=***发送一个请求包，果不其然在SSE的事件流中多了一条事件。</p>
<h2 id="mcpsse">MCP的SSE通信实现</h2>
<p>通过上一个章节的抓包，我们基本摸清了MCP的SSE通信流程：</p>
<ol>
<li>
<p><code>/sse</code> URL建立SSE长链之后先返回一个<code>endpoint</code>(常见为<code>/message</code>)，数据格式为纯文本的同域名URL字符串。</p>
</li>
<li>
<p>client使用POST向<code>endpoint(/message)</code>发送调用请求，POST中的body满足JSON-RPC规范，包含字段 jsonrpc、method、params、id。</p>
</li>
<li>
<p>在 <code>/sse</code>长连接中返回的event满足<code>JSON-RPC</code>规范，包含字段jsonrpc、result、id、error(执行错误时)。</p>
</li>
</ol>
<p>看起好像并不复杂，我们尝试用Python来实现一下（不使用MCP Python SDK）。</p>
<pre><code>from fastapi import FastAPI, Request
import uuid
from sse_starlette.sse import EventSourceResponse
from pydantic import BaseModel
import json

app = FastAPI()
mcpHub = {}

class McpRequest(BaseModel):
    id: Optional[int] = None
    jsonrpc: str
    method: str
    params: Optional[dict] = None

class MCPServer:
    def __init__(self):
      self.queue = asyncio.Queue()

    async def reader(self):
        while True:
            event = await self.queue.get()
            yield event

    async def request(self, payload: McpRequest):
        if payload.method == &quot;initialize&quot;:
            await self.queue.put({&quot;event&quot;: &quot;message&quot;, &quot;data&quot;: ..})
        elif payload.method == &quot;tools/list&quot;:
            ...

@app.get(&quot;/sse&quot;)
async def sse():
    client_id = str(uuid.uuid4())
    mcp = MCPServer()
    mcpHub[client_id] = mcp
    await mcp.queue.put({&quot;event&quot;: &quot;endpoint&quot;, &quot;data&quot;: f&quot;/message?client_id={client_id}&quot;})
    return EventSourceResponse(mcp.reader())

@app.post(&quot;/message&quot;)
async def message(request: Request, payload: McpRequest):
    client_id = request.query_params.get(&quot;client_id&quot;)
    if client_id not in mcpHub:
        return &quot;no client&quot;
    await mcpHub[client_id].request(payload)
    return &quot;ok&quot;
</code></pre>
<p>在这段代码中，我们引入了这样几个设计：</p>
<ol>
<li>
<p>我们使用了<code>asyncio.Queue()</code>来解耦业务流和MCP服务流。这个消息队列联动EventSourceResponse的数据流。每往这个消息队列打一个消息，就会自动通过EventSourceResponse的数据流向Client推送一条消息。这样Client在Server侧看起来就是一个标准的订阅MQ的消费者。</p>
</li>
<li>
<p>在内存中维护一个<code>client_id</code>映射消息队列的字典，这样一旦有消息进入就可以知晓使用的是哪个MQ，然后往对应的MQ里面投递消息。在分布式系统中，这个<code>client_id</code>可以是消息队列的全局唯一标识，这样无论打到哪台机器上，都能够找到正确的队列。</p>
</li>
<li>
<p>服务侧在处理之后，将消息投递回消息队列之后，Client就能感知。MCPServer和MCPClient保持长链之后，后方的业务系统侧理论上可以进行无限时长执行（如果Client侧不主动超时退出），一切均以消息投递回来为准。</p>
</li>
</ol>
<p><img alt="Alt Image Text" src="../../images/chap6_1_3.png" title="Body image" /></p>
<p>我们可以参考文档来看看有哪些method需要被支持：</p>
<p><img alt="Alt Image Text" src="../../images/chap6_1_4.png" title="Body image" /></p>
<p><strong>MCP的订阅模式扩展思考</strong></p>
<p>在MCP的resource的method中，有个不起眼的<code>resources/subcribe</code>引起了我的注意。首先。我们来看看什么是resource，官方给出的定义是：</p>
<blockquote>
<p>Resources represent any kind of data that an MCP server wants to make available to clients. This can include:File contents、Database records、API responses、Live system data、Screenshots and images、Log files、And more</p>
</blockquote>
<p>所以，如果我们使用<code>resources/subcribe</code>订阅一个<code>Database</code>，那么这个数据库的所有变动就会源源不断地推送过来，这就非常近似流计算的常见使用形态了。﻿</p>
<p><strong>因为SSE已经让Server建立向Client的单向数据流，所以如果Client发起一个订阅，我们就创建一个Flink流计算任务向MQ打消息，就非常原生地实现了资源的订阅</strong>。</p>
<p>我们可以扩展一下上面的这个拓扑结构。</p>
<p><img alt="Alt Image Text" src="../../images/chap6_1_5.png" title="Body image" /></p>
<p><strong>1.从大模型视角看流计算：基于MCP协议，大模型实际上能够非常优雅地接入流计算的能力，来完成复杂业务逻辑构建。</strong></p>
<p><strong>2.从流计算视角看大模型：使用MCP协议之后，大模型似乎就变成了一个标准流计算处理节点，能够接收流式消息，也能给向另外的MQ投递消息</strong>。</p>
<p>不得不说，这个确实就是MCP设计上的一个优势。感觉MCP有点像RPC，又有点像MQ，那么这到底是什么呢？我们不妨从编程模型的角度来思考一下。</p>
<h2 id="mcp">MCP的编程模型思考</h2>
<p>MCP从编程模型的角度来看，本质上是一种有状态的<strong>双向RPC（远程过程调用）模型，结合了事件驱动和请求-响应的特性</strong>。这种混合模式使其在AI应用与外部系统集成方面具有独特优势。</p>
<p>MCP的核心特征包括</p>
<p>1.有状态会话：与传统无状态REST API不同，MCP维护会话状态，客户端和服务器之间建立长期连接，会话具有明确的生命周期。</p>
<p>2.双向通信：不仅客户端可以调用服务器（传统RPC模式），服务器也可以调用客户端（反向RPC）。例如，服务器可以请求客户端执行AI采样。</p>
<p>3.基于能力的协商：初始化阶段进行能力协商，动态发现可用功能，适应不同实现和版本。</p>
<p>4.事件通知机制：支持单向通知，资源变更订阅模式，异步事件处理。</p>
<p>5.标准化接口：定义了一组标准操作，使用JSON Schema定义参数和返回值，促进互操作性。</p>
<p>为了更好地理解MCP的定位，我们可以将其与其他常见的编程模型进行比较</p>
<h3 id="mcp-vs-rest-api">MCP vs REST API</h3>
<p><img alt="Alt Image Text" src="../../images/chap6_1_6.png" title="Body image" /></p>
<h3 id="mcp-vs-mq">MCP vs 消息队列（MQ）</h3>
<p><img alt="Alt Image Text" src="../../images/chap6_1_7.png" title="Body image" /></p>
<h3 id="mcp-vs-websocket">MCP vs WebSocket</h3>
<p><img alt="Alt Image Text" src="../../images/chap6_1_8.png" title="Body image" /></p>
<p>MCP在各种编程模型中占据了一个独特的位置：</p>
<ul>
<li>
<p><strong>比REST API更有状态和双向，但比消息队列更直接和轻量</strong>。</p>
</li>
<li>
<p><strong>比WebSocket更结构化和标准化，但比gRPC更灵活和易于理解</strong>。</p>
</li>
<li>
<p><strong>比GraphQL更专注于工具调用，但比RPC更关注资源和上下文</strong>。</p>
</li>
</ul>
<p>同时，正因为MCP这样的一个独特的功能位，不要因为当前的一些能力局限性，就放弃了MCP的原生化的适配。异步任务、事件驱动等架构本身就应该能够原生对接MCP。</p>
<h2 id="mcp_1">MCP服务的简单实现</h2>
<p>既然MCP的整个运行原理并不复杂，我们就尝试自己实现一次，致敬一下这个优秀的设计。</p>
<pre><code>
from fastapi import FastAPI, Request
from sse_starlette.sse import EventSourceResponse
import asyncio
import json
import uuid
from pydantic import BaseModel
from typing import Optional
import uvicorn
import inspect
app = FastAPI()
mcpHub = {}
class McpRequest(BaseModel):
    id: Optional[int] = None
    jsonrpc: str
    method: str
    params: Optional[dict] = None
class MCPServer:
    def __init__(self, name, message_path, tools):
        self.queue = asyncio.Queue()
        self.client_id = str(uuid.uuid4())
        self.message_path = message_path
        self.info = {
            &quot;protocolVersion&quot;: &quot;2024-11-05&quot;,
            &quot;capabilities&quot;: {
                &quot;experimental&quot;: {},
                &quot;tools&quot;: {
                    &quot;listChanged&quot;: False
                }
            },
            &quot;serverInfo&quot;: {
                &quot;name&quot;: name,
                &quot;version&quot;: &quot;1.6.0&quot;
            }
        }
        self.tools = tools
    def list_tool(self):
        result = []
        for tool in self.tools:
            toolInfo = {
                &quot;name&quot;: tool.__name__,
                &quot;description&quot;: tool.__doc__,
                &quot;inputSchema&quot;: {&quot;type&quot;: &quot;object&quot;,&quot;properties&quot;:{}},
            }
            for name, param in inspect.signature(tool).parameters.items():
                toolInfo[&quot;inputSchema&quot;][&quot;properties&quot;][name] = {
                    &quot;title&quot;: name,
                    &quot;type&quot;: &quot;string&quot;,
                }
            result.append(toolInfo)
        return result
    async def reader(self):
        while True:
            event = await self.queue.get()
            yield event
    @staticmethod
    def response(result, id):
        message = {
            &quot;jsonrpc&quot;: &quot;2.0&quot;,
            &quot;result&quot;: result,
        }
        if id is not None:
            message[&quot;id&quot;] = id
        return json.dumps(message)
    async def request(self, req: McpRequest):
        if req.method == &quot;initialize&quot;:
            await self.queue.put({&quot;event&quot;: &quot;message&quot;, &quot;data&quot;: self.response(self.info, req.id)})
        elif req.method == &quot;tools/list&quot;:
            await self.queue.put({&quot;event&quot;: &quot;message&quot;, &quot;data&quot;: self.response({&quot;tools&quot;: self.list_tool()}, req.id)})
        elif req.method == &quot;tools/call&quot;:
            for tool in self.tools:
                if tool.__name__ == req.params.get(&quot;name&quot;):
                    result = await tool(**req.params[&quot;arguments&quot;])
                    await self.queue.put({&quot;event&quot;: &quot;message&quot;, &quot;data&quot;: self.response({&quot;content&quot;: result, &quot;isError&quot;: False}, req.id)})
                    break
async def test(state=None):
    &quot;&quot;&quot;
    description
    &quot;&quot;&quot;
    result = f&quot;hi {state}&quot;
    await asyncio.sleep(1)
    result += &quot;!&quot;
    return result
@app.get(&quot;/receive_test&quot;)
async def receive_test():
    mcp = MCPServer(name=&quot;mcp-test&quot;,message_path=&quot;/send_test&quot;, tools=[test])
    mcpHub[mcp.client_id] = mcp
    await mcp.queue.put({&quot;event&quot;: &quot;endpoint&quot;, &quot;data&quot;: f&quot;{mcp.message_path}?client_id={mcp.client_id}&quot;})
    return EventSourceResponse(mcp.reader())
@app.post(&quot;/send_test&quot;)
async def send_test(request: Request, payload: McpRequest):
    client_id = request.query_params.get(&quot;client_id&quot;)
    if client_id not in mcpHub:
        return &quot;no client&quot;
    await mcpHub[client_id].request(payload)
    return &quot;ok&quot;
if __name__ == &quot;__main__&quot;:
    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8001)
</code></pre>
<p>如上大概100行左右的代码，我们实现了一个简易版本的MCP服务，较官方的MCP Python SDK，我们获得了几个重要的特性优化：</p>
<p>1.tool注册不再依赖@mcp.tool这样的注解，完全可以动态传入，针对不同的场景，提供不同MCP URL，上面提供不同的Tool。</p>
<p>2.编程模型为MQ驱动的服务，对接异步系统、事件驱动的系统或平台较为友好。参考该Python实现，转化成其他语言的版本也较为方便。</p>
<p>3.不依赖 /sse /message 这些默认路由地址，也能正常运行，证明MCP的URL可以完全自定义</p>
<h2 id="mcp_2">总结：理解MCP的本质</h2>
<p>本文深入探讨MCP的原理、通信机制和编程模型本质之后，我们看到MCP不仅仅是一个简单的API或SDK，而是一个精心设计的协议，它：</p>
<p><strong>1.采用client-host-server架构，支持多种服务器连接；</strong></p>
<p><strong>2.实现了有状态的双向RPC模型，结合了事件驱动特性</strong>；</p>
<p><strong>3.提供了标准化的工具调用和资源访问机制；</strong></p>
<p><strong>4.支持动态能力协商和功能发现；</strong></p>
<p>5.相比较MQ、API、WS，占据了独特的功能位置，专为AI应用与外部系统集成而优化；</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>